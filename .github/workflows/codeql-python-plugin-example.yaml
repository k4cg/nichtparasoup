# GitHubActions for CodeQL
# read the docs: https://help.github.com/en/actions/configuring-and-managing-workflows/configuring-a-workflow

name: PythonPluginExample CodeQL

on:
  push:
    branches: [ 'master', '3.0-dev' ]
    paths:
      - '.github/workflows/codeql-python-plugin-example.yaml'
      - '.github/codeql/python-plugin-example.yaml'
      - 'python-plugin-example/**/*.py'
  pull_request:
    branches: [ 'master', '3.0-dev' ]
    paths:
      - '.github/workflows/codeql-python-plugin-example.yaml'
      - '.github/codeql/python-plugin-example.yaml'
      - 'python-plugin-example/**/*.py'
  schedule:
    #        ┌───────────── minute (0 - 59)
    #        │  ┌───────────── hour (0 - 23)
    #        │  │ ┌───────────── day of the month (1 - 31)
    #        │  │ │ ┌───────────── month (1 - 12 or JAN-DEC)
    #        │  │ │ │ ┌───────────── day of the week (0 - 6 or SUN-SAT)
    #        │  │ │ │ │
    #        │  │ │ │ │
    #        │  │ │ │ │
    #        *  * * * *
    - cron: '30 1 * * 0'

defaults:
  run:
    working-directory: python-plugin-example

env:
  config-file: python-plugin-example.yaml

jobs:
  codeql:
    # see https://github.com/github/codeql-action
    name: CodeQL
    runs-on: ubuntu-latest
    steps:
      - name: Fetch Code
        # see https://github.com/actions/checkout
        uses: actions/checkout@v2
        with:
          # We must fetch at least the immediate parents so that if this is
          # a pull request then we can checkout the head.
          fetch-depth: 2
      - run: git checkout HEAD^2
        # If this run was triggered by a pull request event, then checkout
        # the head of the pull request instead of the merge commit.
        if: ${{ github.event_name == 'pull_request' }}
      - name: Initialize CodeQL
        # see https://github.com/github/codeql-action
        uses: github/codeql-action/init@v1
        with:
          languages: python
          config-file: .github/codeql/${{ env.config-file }}
      - name: Perform CodeQL Analysis
        # see https://github.com/github/codeql-action
        uses: github/codeql-action/analyze@v1
